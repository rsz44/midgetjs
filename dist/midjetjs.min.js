/* MIT https://github.com/rsz44/midgetjs */
class ReactiveVar{constructor(s,t){this.__state_instance=s,this.__value=t,this.__callbacks=[],this.__next_value=null,this.hasChange=!1,this.index=null}get value(){return this.hasChange?this.__next_value:this.__value}set value(s){this.__state_instance._register_change(this),this.__next_value=s,this.hasChange=!0}update(){if(this.hasChange){let t=this.__value;this.__value=this.__next_value,this.hasChange=!1;for(var s=this.__callbacks.length-1;s>=0;s--)this.index=s,this.__callbacks[s](this.__state_instance,this.__value,t)}this.index=null}watch(s){this.__callbacks.push(s)}unwatch(s){this.__callbacks=this.__callbacks.filter(function(t){return t!=s})}}class Subscription{constructor(s){this.event=null,this.active=!0,this.events=[],this.callbacks=[],this.unregister_next_id=[],this.unregister_next=[],this.preventNext=!1,this.index=null,this.current_callback_id=null,this.event=s}unregister_callback(s){this.unregister_next.push(s)}unregister_callback_id(s){this.unregister_next_id.push(s)}register_callback(s){var t=Math.floor(100*Math.random())+"-"+Date.now();return this.callbacks.push([t,s]),t}notify(s,t){this.events.push(t)}clean(){this.events=[],this.index=null;var s=this;this.callbacks=this.callbacks.filter(function(t){return!s.unregister_next_id.includes(t[0])}),this.callbacks=this.callbacks.filter(function(t){return!s.unregister_next.includes(t[1])}),this.unregister_next_id=[],this.unregister_next=[]}update(s){for(var t=this.events.length-1;t>=0;t--)if(this.index=t,this.call(s,this.events[t]))return this.clean(),!0;this.clean()}call(s,t){if(this.active){for(var e=this.callbacks.length-1;e>=0;e--)if(this.current_callback_id=this.callbacks[e][0],this.callbacks[e][1](s,this,t),this.preventNext)return this.preventNext=!1,!0;return!1}return!1}}class State{constructor(){this.__events=[],this.subs={},this.__vars={},this.__changes=[]}_register_change(s){this.__changes.push(s)}unsubscribe(s,t){return this.__events.includes(s)||this.__events.push(s),this.subs.hasOwnProperty(s)||(this.subs[s]=new Subscription(s)),this.subs[s].unregister_callback(t)}subscribe(s,t){return this.__events.includes(s)||this.__events.push(s),this.subs.hasOwnProperty(s)||(this.subs[s]=new Subscription(s)),this.subs[s].register_callback(t)}emit(s,t){this.__events.includes(s)||this.__events.push(s),this.subs.hasOwnProperty(s)&&this.subs[s].notify(this,t)}$delete(s){this.__vars.hasOwnProperty(s)&&delete this.__vars[s]}$(s,t=null){return this.__vars.hasOwnProperty(s)||(this.__vars[s]=new ReactiveVar(this,t)),this.__vars[s]}update(){for(var s=this.__events.length-1;s>=0;s--)this.subs.hasOwnProperty(this.__events[s])&&this.subs[this.__events[s]].update(this);var t=this.__changes;for(this.__changes=[];t.length;){t.shift().update()}}}class ReactiveProperties extends State{constructor(s){super();for(const t of Object.entries(s))this.$(t[0],t[1])}}